/*! Simplebird 07-03-2013 */
function tmpl(e,t){return Templates[e]=Templates[e]||Hogan.compile($("#"+e).html()),Templates[e].render(t)}function init(){Grailbird={cur_page:0,payload_details:payload_details,user_details:user_details,tweet_index:tweet_index,data:{},date:function(){var e=this.tweet_index[this.cur_page],t=e.month||0,a=e.year;return CalendarMonths[t-1]+" "+a},tweet_count:function(){var e=this.tweet_index[this.cur_page];return e.tweet_count},tweet_history:function(){for(var e=[],t=0,a=Grailbird.tweet_index[0].year,r=1;0!=r;){var n=$.grep(Grailbird.tweet_index,function(e){return t=Math.max(t,e.tweet_count),e.calendar_month=CalendarMonths[e.month-1],e.year==a});if(n.reverse(),r=n.length,0==r)break;for(var i=n[0].month;n.length>0&&12>n.length;)1==i?n.push({year:a,tweet_count:0,month:n.length+1,calendar_month:CalendarMonths[n.length]}):(n.unshift({year:a,tweet_count:0,month:i,calendar_month:CalendarMonths[i]}),i+=1);e.push({year:a,months:n,max_tweet_count:t}),a--}return e},hasPrev:function(){return!!this.cur_page!=this.tweet_index.length-1},hasNext:function(){return 0!=!!this.cur_page}},$("header").html(tmpl("tmpl_header",Grailbird.user_details)),$(".newtweet").click(function(e){e.preventDefault(),window.open(e.target.getAttribute("href"),"","width=520,height=257,menubar=no,toolbar=no")}),refresh(),setTimeout(function(){$("#tweet_history").html(tmpl("tmpl_history",Grailbird)),drawTweetHistory(),refreshActiveHistory()},10)}function prev(){$("#prev").off("click"),loadPage(Math.min(Grailbird.tweet_index.length-1,Grailbird.cur_page+1))}function next(){$("#next").off("click"),loadPage(Math.max(0,Grailbird.cur_page-1))}function loadPage(e){$("#tweet_list").addClass("hidden"),setTimeout(function(){Grailbird.cur_page=e,refresh()},10)}function refresh(){$("nav").html(tmpl("tmpl_nav",Grailbird)),$("#prev").on("click",prev),$("#next").on("click",next),refreshActiveHistory(),loadTweets(tweet_index[Grailbird.cur_page])}function drawTweetHistory(){var e=parseInt($("#tweet_history ol.tweet_months").data("max-tweet-count"));$("#tweet_history a .count_bar").each(function(t,a){var r=parseInt($(a).data("tweet-count"))/e;$(a).height(100-100*r+"%")}),$("#tweet_history .bar a").click(function(e){var t=$(e.target).parents(".bar").data("var-name");loadHistoryFromVarName(t)})}function refreshActiveHistory(){$("#tweet_history .active").removeClass("active"),$("#tweet_history .bar[data-var-name="+Grailbird.tweet_index[Grailbird.cur_page].var_name+"]").addClass("active")}function loadHistoryFromVarName(e){if(e){var t;$.each(Grailbird.tweet_index,function(a,r){t||r.var_name!=e||(t=a)}),loadPage(t)}}function loadTweets(e){var t=Grailbird.data[e.var_name];t?drawTweets(t):$.getScript(e.file_name,function(){drawTweets(Grailbird.data[e.var_name])})}function drawTweets(e){var t,a="";dataset=e,$.each(e,function(e,r){t=r.retweeted_status||r,r.formatted_content=t.formatted_content=r.formatted_content||getFormattedTweetContent(t),r.formatted_date=t.formatted_date=r.formatted_date||getFormattedDate(t.created_at),r.retweeted_status&&(t.retweeter=r.user.screen_name),a+=tmpl("tmpl_tweet",t)}),setTimeout(function(){$("#tweet_list").html(a).removeClass("hidden")},1)}function getFormattedTweetContent(e){var t=e.text,a=e.entities;return $.each(a.hashtags,function(e){t=t.replace(RegExp("#"+e.text,"g"),'<a href="http://twitter.com/search/'+escape(e.text)+'">#'+e.text+"</a>")}),$.each(a.urls,function(e,a){t=t.replace(RegExp(a.url,"g"),'<a title="'+a.expanded_url+'" href="'+a.expanded_url+'">'+a.display_url+"</a>")}),$.each(a.user_mentions,function(e,a){t=t.replace(RegExp("@"+a.screen_name,"g"),'<a class="atname" href="http://twitter.com/'+a.screen_name+'">'+a.screen_name+"</a>")}),t}function getFormattedDate(e){return new Date(e).toDateString()}var Grailbird={},Templates={},CalendarMonths=["January","February","March","April","May","June","July","August","September","October","November","December"];$.when($.getScript("data/js/payload_details.js"),$.getScript("data/js/user_details.js"),$.getScript("data/js/tweet_index.js")).then(init);